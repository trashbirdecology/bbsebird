---
title: "JAGS Models"
output:
  pdf_document: default
params:
  mod.name: "bbs-grid-level-pois.txt"
  fn.setup: "0_setup.rmd"
---
Use this script to create data for use in JAGS modelling activities. See page [45 of the JAGS manual](https://people.stat.sc.edu/hansont/stat740/jags_user_manual.pdf) for common JAGS functions. 

# Step 0: Setup 
 This chunk sources some redundant chunks in the data-munging r markdown
```{r, include=FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>", 
  message = TRUE, 
  echo=FALSE, 
  warning=FALSE, 
  tidy=TRUE, 
  include=FALSE
)
setup.chunk.needed<-FALSE
temp=tempfile(fileext=".R")
knitr::purl(params$fn.setup, output=temp)
source(temp)
```

# Step 1: Import Data
If data already exists, we can just import it from file. Otherwise, you will need to run through "1-Data_Munging.Rmd", which will take a hot minute.
```{r import-jdat, echo=TRUE}
fn <- list.files(dir.jags, full.names = TRUE, "jdat.rds")
if(length(fn)>1)  "more than one filename in object `fn`. check filenames in dir.jags"
if(length(fn)==0) stop("no files named jdat.rds exist in dir.jags" )

if(!exists("jdat")) jdat <- readRDS(fn) else(cat("jdat already exists in environment. not overwriting."))
cat("jdat is of class ", toupper(class(jdat)) , " and contains the following ", length(jdat), " lists:")
names(jdat)
```

```{r metadata-jdat}
jdat.struc <- get_data_structure(jdat, dir.output=dir.jags)
# View(jdat.struc)
# or
# kableExtra::kable(jdat.struc)
```

# Step 2: Computational Specifications
## MCMC
```{r set-mcmc}
na <- 1000 # number of adaptation iterations
nb <- 5000 # number of iterations for burnin per chain
# nc <- 3 # number of chains (min for now) (defined in call to JAGS as the length of inits list)
ncores <- parallel::detectCores() - 1 # number of cores to use; keep one free just in case, or not
ni <- 10000 # number of iterations per chain
nt <- 10 # thinning rate
```

## Initial values
```{r set-inits} 
inits <- list(
  list(alpha = rnorm(1,0,10), beta1 = rnorm(1,0,10)),
  list(alpha = rnorm(1,0,10), beta1 = rnorm(1,0,10)),     
  list(alpha = rnorm(1,0,10), beta1 = rnorm(1,0,10))
  ) 
```

## Parameters monitored
```{r set-params} 
### must not name `params` b/c will conflict with YAML parameters
params.monitor <- c("lambda", "nu", "alpha", "beta1", "N")
```


# Step 3: Specify Model



# Step 4: Run Model